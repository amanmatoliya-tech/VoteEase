<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Vote | {{ election.name }}</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body {
  background: #ede9fe;
  font-family: 'Poppins', sans-serif;
}

.card {
  border-radius: 18px;
  transition: 0.25s;
  cursor: pointer;
}

.card:hover {
  transform: translateY(-6px);
}

.card.selected {
  border: 3px solid #22c55e;
  box-shadow: 0 0 18px rgba(34,197,94,0.6);
}

.card.blur {
  opacity: 0.35;
}

.timer-bar {
  height: 12px;
  background: #ddd;
  border-radius: 999px;
  overflow: hidden;
}

.timer-fill {
  height: 100%;
  background: linear-gradient(90deg,#22c55e,#16a34a);
  width: 100%;
  transition: width 1s linear;
}

.btn-vote {
  background: linear-gradient(90deg,#22c55e,#16a34a);
  color: white;
  border: none;
  font-size: 1.2rem;
  padding: 12px 40px;
  border-radius: 12px;
  font-weight: 600;
}

.btn-vote:disabled {
  background: gray;
}
</style>
</head>

<body>
<div class="container py-4">

<!-- TITLE -->
<div class="text-center mb-3">
  <h2 class="fw-bold">{{ election.name }}</h2>
</div>

<!-- TIMER -->
{% if election.end_time %}
<div class="card p-3 mb-4 text-center">
  <div class="mb-1 fw-semibold">⏱ Time Remaining</div>
  <div class="mb-2 text-danger fw-bold" id="timeText">--:--</div>
  <div class="timer-bar">
    <div id="timerFill" class="timer-fill"></div>
  </div>
</div>
{% endif %}

{% if has_voted %}
<div class="card p-4 text-center">
  <h4 class="text-success">✅ Vote Submitted</h4>
  <p>You have already cast your vote.</p>
</div>

{% else %}

<!-- CANDIDATES -->
<form method="POST" id="voteForm">
<div class="row justify-content-center">

{% for c in candidates %}
<div class="col-md-4 mb-4">
<label style="width:100%;">
<input type="radio" name="candidate" value="{{ c.id }}" hidden>

<div class="card p-3 text-center">
  <div style="width:130px;height:130px;margin:auto;border-radius:50%;overflow:hidden;">
    <img src="{{ url_for('static', filename='photos/' ~ (c.photo or 'default.png')) }}"
         style="width:100%;height:100%;object-fit:cover;">
  </div>
  <h5 class="mt-3 fw-bold">{{ c.name }}</h5>
</div>

</label>
</div>
{% endfor %}

</div>

<div class="text-center mt-3">
  <button id="voteBtn" class="btn-vote" disabled>Cast Vote</button>
</div>
</form>

{% endif %}

<div class="text-center mt-4">
  <a href="{{ url_for('logout') }}" class="btn btn-outline-danger">Logout</a>
</div>

</div>

<!-- SELECTION SCRIPT -->
<script>
const radios = document.querySelectorAll("input[name='candidate']");
const voteBtn = document.getElementById("voteBtn");

radios.forEach(radio => {
  radio.addEventListener("change", () => {
    document.querySelectorAll(".card").forEach(c=>{
      c.classList.remove("selected","blur");
    });

    const selected = radio.closest("label").querySelector(".card");
    selected.classList.add("selected");

    document.querySelectorAll(".card").forEach(c=>{
      if(c!==selected) c.classList.add("blur");
    });

    voteBtn.disabled = false;
  });
});
</script>

<!-- TIMER SCRIPT -->
{% if election.end_time %}
<script>
const endTime = new Date("{{ election.end_time }}").getTime();
const startTime = new Date("{{ election.start_time }}").getTime();
const total = endTime - startTime;

const timeText = document.getElementById("timeText");
const fill = document.getElementById("timerFill");

setInterval(()=>{
  const now = new Date().getTime();
  const left = endTime - now;

  if(left <= 0){
    timeText.innerText = "00:00";
    fill.style.width = "0%";
    location.reload();
    return;
  }

  const m = Math.floor(left/60000);
  const s = Math.floor((left%60000)/1000);
  timeText.innerText =
    String(m).padStart(2,"0")+":"+String(s).padStart(2,"0");

  fill.style.width = (left/total*100) + "%";
},1000);
</script>
{% endif %}

</body>
</html>





